# Crawl Company Cron調整チケット

## 目的
`crawl-company` Edge Functionの実行間隔を1分に変更し、モニタリング機能を強化する。

## タスク一覧

### Phase 1: Cron設定の調整
- [x] 1.1 cron.jsonの更新
  - [x] 実行間隔を2分から1分に変更
  - [x] 説明文の更新

### Phase 2: モニタリング強化
- [x] 2.1 メトリクス収集の実装
  - [x] process_metricsテーブルとの連携
  - [x] バッチ処理結果の記録
  - [x] 処理時間の計測

- [x] 2.2 ログ管理の実装
  - [x] process_logsテーブルとの連携
  - [x] エラーログの詳細化
  - [x] 処理結果のメタデータ記録

- [x] 2.3 アラート設定
  - [x] エラー率監視の実装
  - [x] Slack通知の設定
  - [x] アラート閾値の設定

### Phase 3: テストと検証
- [ ] 3.1 ローカルテスト
  - [ ] Cronの動作確認
  - [ ] メトリクス収集の確認
  - [ ] アラート発報テスト

- [ ] 3.2 本番環境での検証
  - [ ] パフォーマンス監視
  - [ ] エラー率の監視
  - [ ] リソース使用状況の確認

## 進捗報告
- 作業開始日: 2024/01/07
- 現在のフェーズ: Phase 3
- 次のマイルストーン: ローカルテストの実施

## 作業ログ
### 2024/01/07
- チケット作成
- 現状の確認
  - 現在のcron設定: 2分間隔
  - モニタリング機能: 基本的な実装あり
  - 改善が必要な項目を特定

- Phase 1完了
  - cron.jsonを更新し、実行間隔を1分に変更
  - 説明文を更新

- Phase 2完了
  - メトリクス収集機能を実装
    - process_metricsテーブルとの連携
    - バッチ処理結果の記録
    - 処理時間の計測
  - ログ管理機能を実装
    - process_logsテーブルとの連携
    - エラーログの詳細化
    - 処理結果のメタデータ記録
  - アラート設定を実装
    - エラー率監視（閾値: 20%）
    - Slack通知の設定
    - アラート閾値の設定

- Phase 3開始
  - ローカルテストの準備

## 注意事項
- 設定変更による影響を慎重に監視
- エラー発生時は即座に報告
- リソース使用状況に注意

## 参考資料
- [Edge Function Cronトラブルシューティング](../docs/troubleshooting-edge-function-cron.md)
- [Supabase Edge Functions Documentation](https://supabase.com/docs/guides/functions) 