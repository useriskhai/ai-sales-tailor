# ‰ºÅÊ•≠ÊÉÖÂ†±„ÇØ„É≠„Éº„É™„É≥„Ç∞Ê©üËÉΩ„ÅÆÂÆüË£Ö

## „Ç≥„É≥„ÉÜ„É≥„ÉÑÂèñÂæó„Éó„É≠„Çª„Çπ
### 1. Ê§úÁ¥¢ÊôÇ„ÅÆÂàùÊúüÊÉÖÂ†±ÂèñÂæóÔºà`description`Ôºâ
- ÂÆüË°å„Çø„Ç§„Éü„É≥„Ç∞Ôºö`SearchCompany.tsx`„Åß„ÅÆ‰ºÅÊ•≠Ê§úÁ¥¢ÊôÇ
- ÂèñÂæóÊñπÊ≥ïÔºöGoogle Custom Search API„ÅÆ„Çπ„Éã„Éö„ÉÉ„Éà
- ‰øùÂ≠òÂÖàÔºö`companies.description`„Ç´„É©„É†
- Áî®ÈÄîÔºö‰ºÅÊ•≠„ÅÆÊ¶ÇË¶ÅÊääÊè°„ÄÅÊ§úÁ¥¢ÁµêÊûú„Åß„ÅÆË°®Á§∫

### 2. Ë©≥Á¥∞ÊÉÖÂ†±„ÅÆ„ÇØ„É≠„Éº„É™„É≥„Ç∞Ôºà`website_content`Ôºâ
- ÂÆüË°å„Çø„Ç§„Éü„É≥„Ç∞Ôºö‰ºÅÊ•≠ÁôªÈå≤Âæå„ÅÆÈùûÂêåÊúüÂá¶ÁêÜ
- ÂèñÂæóÊñπÊ≥ïÔºöFirecrawl„Å´„Çà„ÇãÊú¨Ê†ºÁöÑ„Å™„ÇØ„É≠„Éº„É™„É≥„Ç∞
- Âá¶ÁêÜ„Éï„É≠„ÉºÔºö
  1. ‰ºÅÊ•≠ÁôªÈå≤ÂÆå‰∫ÜÂæå„Å´`queue-crawl`„Åß„Ç≠„É•„Éº„Ç§„É≥„Ç∞
  2. `crawl-company`„Åå2ÂàÜÈñìÈöî„ÅßÊú™Âá¶ÁêÜ„Çø„Çπ„ÇØ„ÇíÂá¶ÁêÜ
  3. Firecrawl„Åß„Ç¶„Çß„Éñ„Çµ„Ç§„Éà„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíÂèñÂæó
- ‰øùÂ≠òÂÖàÔºö`companies.website_content`„Ç´„É©„É†
- Áî®ÈÄîÔºöË©≥Á¥∞„Å™‰ºÅÊ•≠ÂàÜÊûê„ÄÅ„Çª„Éº„É´„Çπ„É¨„Çø„Éº„ÅÆÂìÅË≥™Âêë‰∏ä

## ÂÆüË£ÖË©≥Á¥∞

### „ÇØ„É≠„Éº„É´Âá¶ÁêÜ„ÅÆË®≠ÂÆö
- ÂÆüË°åÈñìÈöî: 2ÂàÜ
- „Éê„ÉÉ„ÉÅ„Çµ„Ç§„Ç∫: 1‰ª∂
- „É™„Éà„É©„Ç§ÂõûÊï∞: ÊúÄÂ§ß3Âõû
- „É¨„Éº„ÉàÂà∂Èôê: 2Áßí„ÅÆ„Ç§„É≥„Çø„Éº„Éê„É´

### Firecrawl Professional „Éó„É©„É≥Âà∂Èôê
- 1ÂàÜ„ÅÇ„Åü„Çä: 60„É™„ÇØ„Ç®„Çπ„Éà
- 1Êó•„ÅÇ„Åü„Çä: 10,000„É™„ÇØ„Ç®„Çπ„Éà
- 1„É∂Êúà„ÅÇ„Åü„Çä: 100,000„É™„ÇØ„Ç®„Çπ„Éà

### ÊÉ≥ÂÆöÂá¶ÁêÜÈáè
- 1ÊôÇÈñì„ÅÇ„Åü„Çä: 30‰ª∂Ôºà2ÂàÜ √ó 30ÂõûÔºâ
- 1Êó•„ÅÇ„Åü„Çä: 720‰ª∂Ôºà24ÊôÇÈñì √ó 30ÂõûÔºâ
- 1„É∂Êúà„ÅÇ„Åü„Çä: Á¥Ñ21,600‰ª∂

## ÈÄ≤ÊçóÁä∂Ê≥Å

### Phase 1: Âü∫Áõ§ÂÆüË£Ö ‚úÖ
- [x] Áí∞Â¢ÉÂ§âÊï∞„ÅÆË®≠ÂÆö
  - [x] `.env.local`„ÅÆÊõ¥Êñ∞
  - [x] Firecrawl API„Ç≠„Éº„ÅÆË®≠ÂÆö
- [x] „Éá„Éº„Çø„Éô„Éº„Çπ„Çπ„Ç≠„Éº„Éû„ÅÆÊõ¥Êñ∞
  - [x] `companies`„ÉÜ„Éº„Éñ„É´„ÅÆÊã°ÂºµÔºà`website_content`, `last_crawled_at`„Ç´„É©„É†ËøΩÂä†Ôºâ
  - [x] `crawl_queue`„ÉÜ„Éº„Éñ„É´„ÅÆ‰ΩúÊàê
  - [x] `error_logs`„ÉÜ„Éº„Éñ„É´„ÅÆ‰ΩúÊàê
  - [x] „Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ„ÅÆ‰ΩúÊàê
- [x] ÂûãÂÆöÁæ©„ÅÆÊõ¥Êñ∞
  - [x] `Company`„Ç§„É≥„Çø„Éº„Éï„Çß„Éº„Çπ„ÅÆÊõ¥Êñ∞
  - [x] „Ç≠„É•„ÉºÈñ¢ÈÄ£„ÅÆÂûãÂÆöÁæ©ËøΩÂä†
- [x] „Ç®„É©„Éº„É≠„Ç∞Ê©üËÉΩ„ÅÆÂÆüË£Ö
  - [x] `error-logger.ts`„ÅÆ‰ΩúÊàê
  - [x] „Ç®„É©„Éº„É≠„Ç∞„ÉÜ„Éº„Éñ„É´„ÅÆ‰ΩúÊàê
- [x] Firecrawl„ÇØ„É©„Ç§„Ç¢„É≥„Éà„ÅÆ„Ç§„É≥„Çπ„Éà„Éº„É´
  - [x] „Éë„ÉÉ„Ç±„Éº„Ç∏„ÅÆ„Ç§„É≥„Çπ„Éà„Éº„É´
  - [x] Âãï‰ΩúÁ¢∫Ë™ç

### Phase 2: Edge FunctionÂÆüË£Ö üîÑ
- [x] `queue-crawl` Edge Function„ÅÆ‰ΩúÊàê
  - [x] Âü∫Êú¨ÂÆüË£ÖÔºà`queue-crawl/index.ts`Ôºâ
  - [x] „Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞
  - [x] „ÉÜ„Çπ„Éà
- [x] `crawl-company` Edge Function„ÅÆ‰ΩúÊàê
  - [x] Âü∫Êú¨ÂÆüË£ÖÔºà`crawl-company/index.ts`Ôºâ
  - [x] ‰∏¶ÂàóÂá¶ÁêÜÔºà„Éê„ÉÉ„ÉÅ„Çµ„Ç§„Ç∫: 1‰ª∂Ôºâ
  - [x] „É™„Éà„É©„Ç§Âá¶ÁêÜÔºàÊúÄÂ§ß3ÂõûÔºâ
  - [x] „É¨„Éº„ÉàÂà∂ÈôêÔºà2Áßí„Ç§„É≥„Çø„Éº„Éê„É´Ôºâ
  - [x] „ÉÜ„Çπ„Éà
- [x] Supabase Scheduler„ÅÆË®≠ÂÆö
  - [x] „Çπ„Ç±„Ç∏„É•„Éº„É´Ë®≠ÂÆöÔºà2ÂàÜÈñìÈöî„ÄÅ`cron.json`Ôºâ
  - [x] Âãï‰ΩúÁ¢∫Ë™ç
- [ ] `company-operations`„ÅÆ‰øÆÊ≠£
  - [x] „É°„ÇøÊÉÖÂ†±ÂèñÂæóÂá¶ÁêÜ„ÅÆÂÆüË£ÖÔºà`proxy-html`‰ΩøÁî®Ôºâ
  - [ ] „Ç≠„É•„ÉºÁôªÈå≤Âá¶ÁêÜ„ÅÆËøΩÂä†Ôºà`queue-crawl`ÈÄ£Êê∫Ôºâ
  - [x] „Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞
  - [ ] „ÉÜ„Çπ„Éà
- [ ] `SearchCompany.tsx`„ÅÆ‰øÆÊ≠£
  - [x] Google Custom Search API„Åã„Çâ„ÅÆ`description`ÂèñÂæó
  - [x] Ê§úÁ¥¢ÁµêÊûú„Å∏„ÅÆ`description`Ë°®Á§∫
  - [ ] „ÉÜ„Çπ„Éà

### „ÉÜ„Çπ„Éà üîÑ
- [ ] ÂàùÊúüÊÉÖÂ†±ÂèñÂæó„Éï„É≠„Éº
  - [ ] Google Custom Search API„Åã„Çâ„ÅÆ`description`ÂèñÂæó
  - [ ] „Ç®„É©„ÉºÊôÇ„ÅÆ„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÂá¶ÁêÜ
- [ ] „Ç≠„É•„ÉºÁôªÈå≤„Éï„É≠„Éº
  - [ ] URL„ÅÇ„Çä
  - [ ] URL„Å™„Åó
  - [ ] DBÊé•Á∂ö„Ç®„É©„Éº
- [ ] „ÇØ„É≠„Éº„É´Âá¶ÁêÜ
  - [ ] Âçò‰∏ÄURL
  - [ ] Ë§áÊï∞URL
  - [ ] „Çø„Ç§„É†„Ç¢„Ç¶„Éà
  - [ ] API„Ç®„É©„Éº
- [ ] „É™„Éà„É©„Ç§Âá¶ÁêÜ
  - [ ] „Ç´„Ç¶„É≥„ÉàÂ¢óÂä†
  - [ ] ÊúÄÂ§ßÂõûÊï∞Ë∂ÖÈÅé
- [ ] ‰∏¶ÂàóÂá¶ÁêÜ
  - [ ] ÂêåÊôÇÂÆüË°å
  - [ ] „É™„ÇΩ„Éº„ÇπÁ¢∫Ë™ç
- [ ] „Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞
  - [ ] „É≠„Ç∞Ë®òÈå≤
  - [ ] Âá¶ÁêÜ„ÅÆÁã¨Á´ãÊÄß

## ÊÆã„Çø„Çπ„ÇØ
1. `company-operations`„ÅÆ‰øÆÊ≠£
   - `queue-crawl`„Ç®„É≥„Éâ„Éù„Ç§„É≥„Éà„ÅÆÂëº„Å≥Âá∫„ÅóÂÆüË£Ö
   - ‰ºÅÊ•≠‰øùÂ≠òÂæå„ÅÆ„ÇØ„É≠„Éº„É´Âá¶ÁêÜ„Ç≠„É•„Éº„Ç§„É≥„Ç∞
   - „ÉÜ„Çπ„Éà„ÅÆÂÆüÊñΩ

2. Á∑èÂêà„ÉÜ„Çπ„Éà
   - „Ç≠„É•„ÉºÁôªÈå≤„Åã„Çâ„ÇØ„É≠„Éº„É´ÂÆå‰∫Ü„Åæ„Åß„ÅÆ‰∏ÄÈÄ£„ÅÆ„Éï„É≠„ÉºÁ¢∫Ë™ç
   - „Ç®„É©„Éº„Ç±„Éº„Çπ„ÅÆÊ§úË®º
   - „Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÉÜ„Çπ„Éà

## Â§ßÁõÆÁöÑ
‰ºÅÊ•≠ÁôªÈå≤ÊôÇ„Å´Ëá™ÂãïÁöÑ„Å´„Ç¶„Çß„Éñ„Çµ„Ç§„Éà„ÅÆÊÉÖÂ†±„ÇíÂèñÂæó„Åó„ÄÅ„Éë„Éº„ÇΩ„Éä„É©„Ç§„Ç∫„Åï„Çå„Åü„Çª„Éº„É´„Çπ„É¨„Çø„Éº„ÅÆÂìÅË≥™Âêë‰∏ä„Å´Ê¥ªÁî®„Åô„Çã„ÄÇ

## „Éï„Éº„Çø„Éï„É≠„ÉºË©≥Á¥∞

### 1. ÂàùÊúüÊÉÖÂ†±ÂèñÂæó„Éï„É≠„Éº
1. „É¶„Éº„Ç∂„Éº„Åå‰ºÅÊ•≠Âêç„ÇíÊ§úÁ¥¢
   - `SearchCompany.tsx`„Åß„ÅÆÊ§úÁ¥¢„Ç§„Éô„É≥„ÉàÁô∫ÁÅ´
   - Google Custom Search API„Å∏„ÅÆ„É™„ÇØ„Ç®„Çπ„ÉàÈÄÅ‰ø°
2. Ê§úÁ¥¢ÁµêÊûú„ÅÆÂá¶ÁêÜ
   - „Çπ„Éã„Éö„ÉÉ„ÉàÔºà`description`Ôºâ„ÅÆÊäΩÂá∫
   - ‰ºÅÊ•≠Âü∫Êú¨ÊÉÖÂ†±„Å®„ÅÆÁ¥ê‰ªò„Åë
3. UIË°®Á§∫
   - Ê§úÁ¥¢ÁµêÊûú‰∏ÄË¶ß„Å∏„ÅÆË°®Á§∫
   - „É¶„Éº„Ç∂„Éº„Å´„Çà„Çã‰ºÅÊ•≠ÈÅ∏Êäû

### 2. Ë©≥Á¥∞ÊÉÖÂ†±ÂèñÂæó„Éï„É≠„Éº
1. „Éà„É™„Ç¨„ÉºÔºö‰ºÅÊ•≠„Éá„Éº„Çø„ÅÆÁôªÈå≤
   - `SearchCompany.tsx`„Åß„ÅÆ‰ºÅÊ•≠ÈÅ∏Êäû„ÉªÁôªÈå≤
   - `company-operations`„Åß„ÅÆ‰ºÅÊ•≠„Éá„Éº„Çø‰øùÂ≠ò
   - `queue-crawl`„Åß„ÇØ„É≠„Éº„É´Âá¶ÁêÜ„Çí„Ç≠„É•„Éº„Å´ÁôªÈå≤

2. „Éê„ÉÉ„ÇØ„Ç∞„É©„Ç¶„É≥„ÉâÂá¶ÁêÜÔºà`crawl-company`Ôºâ
   - Supabase Scheduler„Å´„Çà„ÇãÂÆöÊúüÂÆüË°åÔºà2ÂàÜÈñìÈöîÔºâ
   - „Ç≠„É•„Éº„Åã„Çâ„ÅÆÊú™Âá¶ÁêÜ„Çø„Çπ„ÇØÂèñÂæó
   - Firecrawl„Å´„Çà„Çã„Ç¶„Çß„Éñ„Çµ„Ç§„Éà„ÇØ„É≠„Éº„É´
   - „ÇØ„É≠„Éº„É´ÁµêÊûú„ÅÆ`website_content`„Å∏„ÅÆ‰øùÂ≠ò
   - „Ç®„É©„ÉºÁô∫ÁîüÊôÇ„ÅÆ„É™„Éà„É©„Ç§ÁÆ°ÁêÜ

## „Éï„Ç°„Ç§„É´ÊßãÈÄ†
```
src/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îî‚îÄ‚îÄ SearchCompany.tsx      # ‰ºÅÊ•≠Ê§úÁ¥¢„ÉªÁôªÈå≤„Ç≥„É≥„Éù„Éº„Éç„É≥„ÉàÔºà‰øÆÊ≠£Ôºâ
‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îî‚îÄ‚îÄ company.ts            # ‰ºÅÊ•≠ÊÉÖÂ†±„ÅÆÂûãÂÆöÁæ©Ôºà‰øÆÊ≠£Ôºâ
supabase/
‚îî‚îÄ‚îÄ functions/
    ‚îú‚îÄ‚îÄ company-operations/   # ‰ºÅÊ•≠ÊÉÖÂ†±Êìç‰ΩúÈñ¢ÈÄ£„ÅÆÈñ¢Êï∞Ôºà‰øÆÊ≠£Ôºâ
    ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
    ‚îú‚îÄ‚îÄ queue-crawl/         # „ÇØ„É≠„Éº„É´Âá¶ÁêÜ„ÅÆ„Ç≠„É•„ÉºÁôªÈå≤ÔºàÊñ∞Ë¶èÔºâ
    ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
    ‚îú‚îÄ‚îÄ crawl-company/       # „ÇØ„É≠„Éº„É´Âá¶ÁêÜ„ÅÆ„ÉØ„Éº„Ç´„ÉºÔºàÊñ∞Ë¶èÔºâ
    ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
    ‚îî‚îÄ‚îÄ _shared/
        ‚îú‚îÄ‚îÄ types.ts         # ÂÖ±ÊúâÂûãÂÆöÁæ©Ôºà‰øÆÊ≠£Ôºâ
        ‚îî‚îÄ‚îÄ error-logger.ts  # „Ç®„É©„Éº„É≠„Ç∞Ê©üËÉΩÔºàÊñ∞Ë¶èÔºâ
.env.local                   # Áí∞Â¢ÉÂ§âÊï∞Ôºà‰øÆÊ≠£Ôºâ
```

## ‰øÆÊ≠£ÂØæË±°„Éï„Ç°„Ç§„É´„Å®Â§âÊõ¥ÂÜÖÂÆπ

### 1. `.env.local`
#### ÁèæÁä∂
```
GOOGLE_SEARCH_API_KEY="..."
GOOGLE_SEARCH_ENGINE_ID="..."
NEXT_PUBLIC_SUPABASE_ANON_KEY="..."
NEXT_PUBLIC_SUPABASE_URL="..."
```

#### „ÅÇ„Çã„Åπ„ÅçÂßø
```
GOOGLE_SEARCH_API_KEY="..."
GOOGLE_SEARCH_ENGINE_ID="..."
NEXT_PUBLIC_SUPABASE_ANON_KEY="..."
NEXT_PUBLIC_SUPABASE_URL="..."
FIRECRAWL_API_KEY="fc-6f51ce0b6b2f456082367c62e04b493b"
```

### 2. `src/types/company.ts`
#### ÁèæÁä∂
```typescript
export interface Company {
  id: string;
  name: string;
  url?: string;
  description?: string;
}
```

#### „ÅÇ„Çã„Åπ„ÅçÂßø
```typescript
export interface Company {
  id: string;
  name: string;
  url?: string;
  description?: string;
  website_content?: string;  // „Éû„Éº„ÇØ„ÉÄ„Ç¶„É≥ÂΩ¢Âºè„ÅÆ„Ç¶„Çß„Éñ„Çµ„Ç§„Éà„Ç≥„É≥„ÉÜ„É≥„ÉÑ
  last_crawled_at?: string;
}
```

### 3. `src/components/SearchCompany.tsx`
#### ÁèæÁä∂
```typescript
const handleConfirmSelection = async () => {
  const { data: result, error } = await supabase.functions.invoke('company-operations', {
    body: {
      action: 'insertCompanies',
      data: {
        companies: targetCompanies,
        userId: session.user.id,
        searchKeyword
      }
    }
  });
  // ...
};
```

#### „ÅÇ„Çã„Åπ„ÅçÂßø
```typescript
const handleConfirmSelection = async () => {
  try {
    const { data: result, error } = await supabase.functions.invoke('company-operations', {
      body: {
        action: 'insertCompanies',
        data: {
          companies: targetCompanies,
          userId: session.user.id,
          searchKeyword
        }
      }
    });

    if (error) throw error;

    if (onClose) {
      onClose();
    }
    onCompaniesSelected(result);
  } catch (error) {
    console.error('‰ºÅÊ•≠ÁôªÈå≤„Ç®„É©„Éº:', error);
  }
};
```

### 4. `supabase/functions/company-operations/index.ts`
#### ÁèæÁä∂
```typescript
export async function insertCompanies(companies: Partial<Company>[]) {
  const { data, error } = await supabase
    .from('companies')
    .upsert(companies.map(company => ({
      name: company.name,
      url: company.url,
      description: company.description,
      created_at: new Date().toISOString()
    })));
  // ...
}
```

#### „ÅÇ„Çã„Åπ„ÅçÂßø
```typescript
export async function insertCompanies(companies: Partial<Company>[]) {
  // 1. ‰ºÅÊ•≠ÊÉÖÂ†±„ÅÆ‰øùÂ≠ò
  const { data: insertedCompanies, error } = await supabase
    .from('companies')
    .upsert(companies.map(company => ({
      name: company.name,
      url: company.url,
      description: company.description,
      created_at: new Date().toISOString()
    })))
    .select();

  if (error) throw error;

  // 2. „ÇØ„É≠„Éº„É´Âá¶ÁêÜ„ÅÆ„Ç≠„É•„Éº„Å∏„ÅÆÁôªÈå≤
  for (const company of insertedCompanies) {
    if (company.url) {
      try {
        await supabase.functions.invoke('queue-crawl', {
          body: { company_id: company.id }
        });
      } catch (error) {
        console.error(`Failed to queue crawling for ${company.name}: ${error}`);
        // „Ç®„É©„Éº„ÅØË®òÈå≤„Åô„Çã„Åå„ÄÅÂá¶ÁêÜ„ÅØÁ∂öË°å
      }
    }
  }

  return insertedCompanies;
}
```

### 5. `supabase/functions/queue-crawl/index.ts`ÔºàÊñ∞Ë¶èÔºâ
```typescript
import { serve } from "https://deno.land/std@0.168.0/http/server.ts"
import { corsHeaders } from '../_shared/cors.ts'
import { supabase } from '../_shared/supabase-client.ts'
import { logError } from '../_shared/error-logger.ts'

serve(async (req) => {
  if (req.method === 'OPTIONS') {
    return new Response('ok', { headers: corsHeaders });
  }

  try {
    const { company_id } = await req.json();

    // „Ç≠„É•„Éº„Å∏„ÅÆÁôªÈå≤
    const { error } = await supabase
      .from('crawl_queue')
      .insert({
        company_id,
        status: 'pending',
        retry_count: 0
      });

    if (error) throw error;

    return new Response(
      JSON.stringify({ success: true }),
      { headers: { ...corsHeaders, 'Content-Type': 'application/json' } }
    );

  } catch (error) {
    console.error('Queue error:', error);
    await logError(error, {
      company_id: req.body?.company_id,
      action: 'queue-crawl'
    });

    return new Response(
      JSON.stringify({ error: error.message }),
      { 
        headers: { ...corsHeaders, 'Content-Type': 'application/json' },
        status: 500
      }
    );
  }
});
```

### 6. `supabase/functions/crawl-company/index.ts`ÔºàÊñ∞Ë¶èÔºâ
```typescript
import { serve } from "https://deno.land/std@0.168.0/http/server.ts"
import { corsHeaders } from '../_shared/cors.ts'
import { supabase } from '../_shared/supabase-client.ts'
import { logError } from '../_shared/error-logger.ts'
import FirecrawlApp from '@mendable/firecrawl-js'

const FIRECRAWL_API_KEY = Deno.env.get('FIRECRAWL_API_KEY');
if (!FIRECRAWL_API_KEY) {
  throw new Error('FIRECRAWL_API_KEY is not set');
}

const app = new FirecrawlApp({ apiKey: FIRECRAWL_API_KEY });

const BATCH_SIZE = 5;
const MAX_RETRIES = 3;

serve(async (req) => {
  if (req.method === 'OPTIONS') {
    return new Response('ok', { headers: corsHeaders });
  }

  try {
    // 1. „Ç≠„É•„Éº„Åã„ÇâÊú™Âá¶ÁêÜ„Çø„Çπ„ÇØ„ÇíÂèñÂæó
    const { data: tasks, error: fetchError } = await supabase
      .from('crawl_queue')
      .select('id, company_id, retry_count')
      .eq('status', 'pending')
      .lt('retry_count', MAX_RETRIES)
      .order('created_at', { ascending: true })
      .limit(BATCH_SIZE);

    if (fetchError) throw fetchError;
    if (!tasks?.length) {
      return new Response(
        JSON.stringify({ message: 'No pending tasks' }),
        { headers: { ...corsHeaders, 'Content-Type': 'application/json' } }
      );
    }

    // 2. ‰∏¶ÂàóÂá¶ÁêÜ„Åß„ÇØ„É≠„Éº„É´ÂÆüË°å
    const results = await Promise.allSettled(
      tasks.map(async (task) => {
        try {
          // 2.1 ‰ºÅÊ•≠ÊÉÖÂ†±„ÅÆÂèñÂæó
          const { data: company, error: companyError } = await supabase
            .from('companies')
            .select('id, name, url')
            .eq('id', task.company_id)
            .single();

          if (companyError) throw companyError;
          if (!company?.url) throw new Error('URL is not set');

          // 2.2 Firecrawl„Åß„Ç¶„Çß„Éñ„Çµ„Ç§„Éà„Çí„ÇØ„É≠„Éº„É´
          const crawlResult = await app.scrapeUrl(company.url, {
            pageOptions: {
              fetchPageContent: true
            }
          });

          // 2.3 „ÇØ„É≠„Éº„É´ÁµêÊûú„Çí‰øùÂ≠ò
          const { error: updateError } = await supabase
            .from('companies')
            .update({
              website_content: crawlResult.data.markdown,
              last_crawled_at: new Date().toISOString()
            })
            .eq('id', company.id);

          if (updateError) throw updateError;

          // 2.4 „Ç≠„É•„Éº„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„ÇíÊõ¥Êñ∞
          await supabase
            .from('crawl_queue')
            .update({ status: 'completed' })
            .eq('id', task.id);

          return { success: true, company_id: company.id };

        } catch (error) {
          // „Ç®„É©„ÉºÊôÇ„ÅØ„É™„Éà„É©„Ç§„Ç´„Ç¶„É≥„Éà„ÇíÂ¢ó„ÇÑ„Åô
          await supabase
            .from('crawl_queue')
            .update({ 
              status: 'failed',
              retry_count: task.retry_count + 1,
              error_message: error.message
            })
            .eq('id', task.id);

          throw error;
        }
      })
    );

    // 3. ÁµêÊûú„ÅÆÈõÜË®à
    const summary = {
      total: results.length,
      succeeded: results.filter(r => r.status === 'fulfilled').length,
      failed: results.filter(r => r.status === 'rejected').length
    };

    return new Response(
      JSON.stringify(summary),
      { headers: { ...corsHeaders, 'Content-Type': 'application/json' } }
    );

  } catch (error) {
    console.error('Crawling error:', error);
    await logError(error, {
      action: 'crawl-company'
    });

    return new Response(
      JSON.stringify({ error: error.message }),
      { 
        headers: { ...corsHeaders, 'Content-Type': 'application/json' },
        status: 500
      }
    );
  }
});
```

### 7. `supabase/functions/_shared/error-logger.ts`
```typescript
export async function logError(error: Error, context: {
  company_id?: string;
  company_name?: string;
  action: string;
}) {
  try {
    await supabase
      .from('error_logs')
      .insert({
        error_message: error.message,
        error_stack: error.stack,
        context: context,
        created_at: new Date().toISOString()
      });
  } catch (logError) {
    console.error('„Ç®„É©„Éº„É≠„Ç∞„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó:', logError);
  }
}
```

## „Éá„Éº„Çø„Éô„Éº„ÇπÂ§âÊõ¥
```sql
ALTER TABLE companies 
ADD COLUMN IF NOT EXISTS website_content TEXT,
ADD COLUMN IF NOT EXISTS last_crawled_at TIMESTAMP WITH TIME ZONE;

-- „ÇØ„É≠„Éº„É´Âá¶ÁêÜ„ÅÆ„Ç≠„É•„Éº„ÉÜ„Éº„Éñ„É´
CREATE TABLE IF NOT EXISTS crawl_queue (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  company_id UUID NOT NULL REFERENCES companies(id),
  status TEXT NOT NULL CHECK (status IN ('pending', 'processing', 'completed', 'failed')),
  retry_count INTEGER DEFAULT 0,
  error_message TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

-- „Ç®„É©„Éº„É≠„Ç∞„ÉÜ„Éº„Éñ„É´
CREATE TABLE IF NOT EXISTS error_logs (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  error_message TEXT NOT NULL,
  error_stack TEXT,
  context JSONB,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

-- „Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ
CREATE INDEX IF NOT EXISTS idx_crawl_queue_status ON crawl_queue(status);
CREATE INDEX IF NOT EXISTS idx_crawl_queue_company_id ON crawl_queue(company_id);
```

## ÂÆüË£ÖÊâãÈ†Ü

### Phase 1: Âü∫Áõ§ÂÆüË£ÖÔºà1Êó•Ôºâ
1. Áí∞Â¢ÉÂ§âÊï∞„ÅÆË®≠ÂÆö
2. „Éá„Éº„Çø„Éô„Éº„Çπ„Çπ„Ç≠„Éº„Éû„ÅÆÊõ¥Êñ∞
   - `companies`„ÉÜ„Éº„Éñ„É´„ÅÆÊã°Âºµ
   - `crawl_queue`„ÉÜ„Éº„Éñ„É´„ÅÆ‰ΩúÊàê
   - `error_logs`„ÉÜ„Éº„Éñ„É´„ÅÆ‰ΩúÊàê
   - „Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ„ÅÆ‰ΩúÊàê
3. ÂûãÂÆöÁæ©„ÅÆÊõ¥Êñ∞
4. „Ç®„É©„Éº„É≠„Ç∞Ê©üËÉΩ„ÅÆÂÆüË£Ö
5. Firecrawl„ÇØ„É©„Ç§„Ç¢„É≥„Éà„ÅÆ„Ç§„É≥„Çπ„Éà„Éº„É´

### Phase 2: Edge FunctionÂÆüË£ÖÔºà2Êó•Ôºâ
1. `queue-crawl` Edge Function„ÅÆ‰ΩúÊàê
2. `crawl-company` Edge Function„ÅÆ‰ΩúÊàê
3. `company-operations`„ÅÆ‰øÆÊ≠£
4. Supabase Scheduler„ÅÆË®≠ÂÆö
5. „Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞„ÅÆÂÆüË£Ö

## „ÉÜ„Çπ„ÉàË®àÁîª
1. ÂàùÊúüÊÉÖÂ†±ÂèñÂæó„Éï„É≠„Éº
   - Google Custom Search API„Åã„Çâ„ÅÆ`description`ÂèñÂæó
   - „Ç®„É©„ÉºÊôÇ„ÅÆ„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÂá¶ÁêÜ
2. „Ç≠„É•„ÉºÁôªÈå≤„Éï„É≠„Éº
   - Ê≠£Â∏∏Á≥ªÔºöURL„ÅÇ„Çä/„Å™„Åó
   - Áï∞Â∏∏Á≥ªÔºöDBÊé•Á∂ö„Ç®„É©„Éº
3. „ÇØ„É≠„Éº„É´Âá¶ÁêÜ
   - Ê≠£Â∏∏Á≥ªÔºöÂçò‰∏ÄURL/Ë§áÊï∞URL
   - Áï∞Â∏∏Á≥ªÔºö„Çø„Ç§„É†„Ç¢„Ç¶„Éà„ÄÅAPI„Ç®„É©„Éº
4. „É™„Éà„É©„Ç§Âá¶ÁêÜ
   - „É™„Éà„É©„Ç§„Ç´„Ç¶„É≥„Éà„ÅÆÂ¢óÂä†
   - ÊúÄÂ§ß„É™„Éà„É©„Ç§ÂõûÊï∞Ë∂ÖÈÅé
5. ‰∏¶ÂàóÂá¶ÁêÜ
   - Ë§áÊï∞„Çø„Çπ„ÇØ„ÅÆÂêåÊôÇÂÆüË°å
   - „É™„ÇΩ„Éº„Çπ‰ΩøÁî®Èáè„ÅÆÁ¢∫Ë™ç
6. „Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞
   - „Ç®„É©„Éº„É≠„Ç∞„ÅÆË®òÈå≤
   - Âá¶ÁêÜ„ÅÆÁã¨Á´ãÊÄßÁ¢∫Ë™ç

## Ë¶ãÁ©ç„ÇÇ„ÇäÂ∑•Êï∞
- Âü∫Áõ§ÂÆüË£Ö: 1‰∫∫Êó•
- Edge FunctionÂÆüË£Ö: 2‰∫∫Êó•
ÂêàË®à: 3‰∫∫Êó• 