# バッチジョブ詳細 - 改善提案タブ

## 画面概要
バッチジョブの改善提案（Act）を表示・管理する画面。AIによる分析結果と改善提案、次アクションの設定が可能。

## 1. AI分析サマリー (Overview)

### 目的
バッチジョブ全体の結果を総括し、どんな指標が良かった/悪かったか、AIがどこに注目したかを要約表示する。

### 表示内容
1. **総合評価 / スコア**
   - データソース: `batch_jobs.metrics_results.improvement_analysis.scores.total`
   - 前回比: `metrics_results.improvement_analysis.scores.trend`
   - 例：「スコア: 82 (↑ +14%)」

2. **主な成功点や発見（findings）**
   - データソース: `batch_jobs.metrics_results.improvement_analysis.findings`
   - 例：「メール本文の品質が15%向上」「新しい変数追加でクリック率増加」

3. **改善すべき領域（opportunities）**
   - データソース: `batch_jobs.metrics_results.improvement_analysis.opportunities`
   - 例：「送信時間の最適化」「業界別キーワードの追加」

4. **推奨アクション要旨（recommended_actions）**
   - データソース: `batch_jobs.metrics_results.improvement_analysis.actions`
   - 数や重要度を簡潔に表示し、下部の改善提案リストへ誘導

## 2. 改善提案リスト (Suggestions)

### 目的
具体的なテンプレート（template_id）に対する提案を一覧化し、ユーザーが「見る・適用する・却下する」を行いやすくする。

### 表示内容
1. **提案タイトルと概要**
   - データソース: `batch_jobs.metrics_results.improvement_analysis.suggestions`
   - 表示項目:
     - タイトル: `title`
     - 概要: `description`
     - 種別: `type` (content/prompt/tone/variable等)

2. **期待改善率**
   - データソース: `metrics_results.improvement_analysis.suggestions[].expected_improvement`
   - パーセンテージ表示

3. **提案ステータス**
   - データソース: `metrics_results.improvement_analysis.suggestions[].status`
   - 状態: pending/applied/rejected

4. **アクションボタン**
   - 適用: PUTリクエスト `/api/batch-jobs/{id}/suggestions/{suggestion_id}/apply`
   - 却下: PUTリクエスト `/api/batch-jobs/{id}/suggestions/{suggestion_id}/reject`

### 詳細表示（モーダル/サイドパネル）
```json
{
  "suggestion_id": "uuid",
  "type": "content",
  "sections": [
    {
      "section": "導入部",
      "current": "貴社の課題として...（略）",
      "suggested": "より業界固有の痛みにフォーカスし...（略）",
      "reason": "業界固有の表現を入れることで共感を得やすくなる",
      "expected_improvement": 0.18
    }
  ]
}
```

## 3. 次回アクション (Next Actions)

### 目的
改善提案を踏まえ、具体的な次のステップをユーザーに提示する。

### 表示内容
1. **推奨の追加アクション**
   - データソース: `batch_jobs.metrics_results.improvement_analysis.next_actions`
   - 優先順位付きのアクションリスト

2. **新規バッチジョブ作成ボタン**
   - POSTリクエスト `/api/batch-jobs/create-from-template`
   - パラメータ:
     - `template_id`: 現在のテンプレートID
     - `applied_suggestions`: 適用する提案のID配列

3. **テンプレート更新フロー**
   - PUTリクエスト `/api/templates/{id}/update`
   - 更新完了のガイダンス表示

## 画面レイアウト

```
+--------------------------------------------------+
|                    ヘッダー                        |
| < 一覧に戻る                                      |
| バッチジョブ詳細: [ジョブ名]                       |
+--------------------------------------------------+
|                                                  |
| [前提条件] [レター作成・送信] [実績分析] [改善提案] |
|                                                  |
+--------------------------------------------------+
|                                                  |
| AI分析サマリー                                    |
| +----------------------------------------------+ |
| | スコア: 82 (↑ +14%)                            |
| | 主な発見: 送信時間帯で到達率に差…など          |
| | 改善すべき領域: 送信時間帯, 内容パーソナライズ…|
| | 推奨アクション: 2件                             |
| +----------------------------------------------+ |
|                                                  |
| 改善提案リスト                                    |
| +----------------------------------------------+ |
| | 優先度   | 提案内容           | 改善率 | ステータス  |
| |-------------------------------------------|
| | 高      | 導入文に業界キーワード| +15%   | [適用する] |
| | 中      | トーン調整(やや砕けた)| +5%    | [適用する] |
| | 低      | 変数を追加する       | +3%    | [却下]    |
| +----------------------------------------------+ |
|                                                  |
| 次回アクション                                    |
| +----------------------------------------------+ |
| | 1. 業界キーワードを加えたテンプレートを作成    |
| | 2. 変数A, Bを試験導入                         |
| | [新規バッチジョブ作成]                         |
| +----------------------------------------------+ |
+--------------------------------------------------+
```

## インタラクティブ要素

### 1. AI分析サマリーセクション
- **詳細表示**
  - 各指標のドリルダウン
  - データに基づく根拠説明

### 2. 改善提案リストセクション
- **提案カード**
  - クリックで詳細モーダル表示
  - JSON内容の整形表示
- **アクションボタン**
  - 適用/却下の状態管理
  - 適用履歴の記録

### 3. 次回アクションセクション
- **新規ジョブ作成**
  - 提案適用状態の引き継ぎ
  - テンプレート更新オプション

## エラーハンドリング
- AI分析データ不足時の警告表示
- 提案適用時のバリデーション
- 更新失敗時のリカバリー処理

## レスポンシブ対応
- デスクトップ: フル表示
- タブレット: スクロール可能なレイアウト
- モバイル: 
  - カード形式の提案表示
  - 重要アクションの優先表示 